{
	"meta": {
		"name": "Pawnographic chess",
		"source": "http://www.di.fc.ul.pt/~jpn/gv/pawnographic.htm"
	},
	"board": { "height": 8, "width": 8 },
	"graphics": {
		"tiles": {"bases":"grass"}, "icons": {"pawns":"pawns"}
	},
	"setup": { "pawns":[ ["rectangle",2001,2008,1,{"dir":5}], ["rectangle",7001,7008,2,{"dir":1}] ] },
	"terrain": {
		"startrows": [ ["rectangle",2001,2008,1], ["rectangle",7001,7008,2] ],
		"bases": [ ["rectangle",1001,1008,1], ["rectangle",8001,8008,2] ]
	},
	"startturn": {
		"runGenerators": ["findoppshadows"],
		"applyEffects": [["forallin","myunits",["removeunitdata",["loopid"],"turbo"]]],
		"allow": [["mark","selectunit"]]
	},
	"afterstep": {
		"allow": [["endturn"]]
	},
	"endturn": {
		"endgame": {
			"infiltration": {"condition": ["overlaps","myunits","oppbases"], "result": "win" },
			"genocide": {"condition": ["isempty","oppunits"], "result": "win"}
		}
	},
	"commands": {
		"move": {
			"applyEffects": [
				["if",["same",2,["lookup","movetargets","selectmove","step"]],
					["setunitdata",["idofunitat","selectunit"],"turbo",true]
				],
				["moveunit",["idofunitat","selectunit"],"selectmove"]
			]
		},
		"kill": {
			"applyEffects": [
				["ifelse",
					["anyat","oppshadows","selectkill"],
					["killunit",["id",["lookup","oppshadows","selectkill","id"]]],
					["killunit",["idofunitat","selectkill"]]
				],
				["moveunit",["idofunitat","selectunit"],"selectkill"]
			]
		}
	},
	"marks": {
		"selectunit": {
			"from": "myunits",
			"runGenerators": ["findwalktargets","findkilltargets"],
			"allow": [["mark","selectmove"],["mark","selectkill"]]
		},
		"selectmove": {
			"from": "movetargets",
			"allow": [["command","move"]]
		},
		"selectkill": {
			"from": "killtargets",
			"allow": [["command","kill"]]
		}
	},
	"generators": {
		"findwalktargets": {
			"type": "walker",
			"starts": "selectunit",
			"max": ["ifelse",["anyat","startrows",["contextpos","start"]],2,1],
			"blocks": "units",
			"dirs": ["relativedirs",["dirs",[1]],["lookup","units",["contextpos","start"],"dir"]],
			"draw": {
				"steps": {
					"tolayer": "movetargets",
					"include": { "step": ["contextval","step"] }
				}
			}
		},
		"findoppshadows": {
			"type": "nextto",
			"starts": "oppunits",
			"dirs": ["relativedirs",["dirs",[5]],["lookup","units",["contextpos","start"],"dir"]],
			"condition": ["truthy",["lookup","oppunits",["contextpos","start"],"turbo"]],
			"draw": {
				"target": {
					"tolayer": "oppshadows",
					"include": {"id":["idofunitat",["contextpos","start"]]}	
				}
			}
		},
		"findkilltargets": {
			"type": "nextto",
			"starts": "selectunit",
			"dirs": ["relativedirs",["dirs",[8,2]],["lookup","units",["contextpos","start"],"dir"]],
			"condition": ["anyat",["union","oppunits","oppshadows"],["contextpos","target"]],
			"draw": {
				"target": {
					"tolayer": "killtargets"
				}
			}
		}
	}
}
{
	"source": "http://www.di.fc.ul.pt/~jpn/gv/krieg.htm",
	"board": {
		"width": 4,
		"height": 4
	},
	"terrain": {
		"southeast": [ ["positions",[1001,3003],{}] ],
		"northwest": [ ["positions",[2002,4004],{}] ],
		"corners": [
			{"owner":1,"pos":1001},
			{"owner":2,"pos":4004}
		],
		"bases": [
			["positions",[1002,2001,2002],{"owner":1}],
			["positions",[3003,3004,4003],{"owner":2}]
		]
	},
	"setup": [
		["rectangle",[1001,2002],{"owner":1}],
		["rectangle",[3003,4004],{"owner":2}]
	],
	"marks": {
		"selectunit": {
			"fromlayer": "movers",
			"cleanse": ["currentmoves"],
			"hydration": ["findcurrentmoves"]
		},
		"selectmove": {
			"neededmarks": ["selectunit"],
			"fromlayer": "currentmoves"
		}
	},
	"startturn": {
		"hydration": ["findmymovers","findmovetargets"]
	},
	"endturn": {
		"condition": ["same",["contextval","performedsteps"],["val",1]],
		"commandcap": true,
		"endgame": {
			"cornerinfiltration": {
				"hydration": ["findinfiltrators"],
				"condition": ["notempty","infiltrators"]
			},
			"occupation": {
				"hydration": ["findoccupiers"],
				"condition": ["morethanTHAN",1,["layerobjectcount","infiltrators"]]
			},
			"oppcantmove": {
				"hydration": ["findoppmovers","findmovetargets"],
				"condition": ["isempty","movers"]
			}
		}
	},
	"commands": {
		"move": {
			"neededmarks": ["selectunit","selectmove"],
			"condition": ["notempty","forwardfooting"],
			"effect": ["moveunit",["idofunitat",["markpos","selectunit"]],["markpos","selectmove"]]
		}
	},
	"generators": {
		"findoccupiers": {
			"type": "filter",
			"layer": "bases",
			"matching": {"owner":["isnt",["contextval","currentplayer"]]},
			"condition": ["anyat","MYunits",["contextpos","start"]],
			"tolayer": ["layername","occupiers"]
		},
		"findinfiltrators": {
			"type": "filter",
			"layer": "corners",
			"matching": {"owner":["isnt",["contextval","currentplayer"]]},
			"condition": ["anyat","MYunits",["contextpos","start"]],
			"tolayer": ["layername","infiltrators"]
		},
		"findcurrentmoves": {
			"type": "filter",
			"layer": "movetargets",
			"matching": {"moverid":["idofunitat",["markpos","selectunit"]]}
		},
		"findmymovers": {
			"type": "filter",
			"layer": "MYunits",
			"condition": ["different",
				["sum",["contextval","CURRENTTURN"],["val",-2]],
				["lookup","MYunits",["contextpos","start"],"affectedturn"]
			],
			"tolayer": "freetomove"
		},
		"findoppmovers": {
			"type": "filter",
			"layer": "OPPunits",
			"condition": ["different",
				["sum",["contextval","CURRENTTURN"],["val",-3]],
				["lookup","OPPunits",["contextpos","start"],"affectedturn"]
			],
			"tolayer": "freetomove"
		},
		"findmovetargets": {
			"type": "nextto",
			"from": ["ALLINLAYER","freetomove"],
			"dirs": ["ifelse",
				["anyat","southeast",["contextpos","start"]],
				["dirs",[1,3,4,5,7]],
				["ifelse",
					["anyat","northwest",["contextpos","start"]],
					["dirs",[1,3,5,7,8]],
					["dirs",[1,3,5,7]]
				]
			],
			"draw": {
				"start": {
					"condition": ["different",["contextval","neighbourcount"],["val",0]],
					"tolayer": ["layername","movers"]
				},
				"target": {
					"tolayer": ["layername","movetargets"],
					"include": {
						"moverid": ["idofunitat",["contextpos","start"]]
					}
				}
			}
		}
	}
}
{
	"source": "http://www.di.fc.ul.pt/~jpn/gv/krieg.htm",
	"board": {
		"width": 4,
		"height": 4
	},
	"terrain": {
		"southeast": [ ["positions",[1001,3003],{}] ],
		"northwest": [ ["positions",[2002,4004],{}] ],
		"corners": [
			{"owner":1,"pos":1001},
			{"owner":2,"pos":4004}
		],
		"bases": [
			["positions",[1002,2001,2002],{"owner":1}],
			["positions",[3003,3004,4003],{"owner":2}]
		]
	},
	"setup": [
		["rectangle",[1001,2002],{"owner":1}],
		["rectangle",[3003,4004],{"owner":2}]
	],
	"marks": {
		"selectunit": {
			"fromlayer": "movers",
			"cleanse": ["currentmoves"],
			"hydration": ["findcurrentmoves"]
		},
		"selectmove": {
			"neededmarks": ["selectunit"],
			"fromlayer": "currentmoves"
		}
	},
	"startturn": {
		"hydration": ["findmymovers","findmovetargets"]
	},
	"endturn": {
		"condition": ["SAME",["CONTEXTVAL","PERFORMEDSTEPS"],["VAL",1]],
		"commandcap": true,
		"endgame": {
			"cornerinfiltration": {
				"hydration": ["findinfiltrators"],
				"condition": ["NOTEMPTY","infiltrators"]
			},
			"occupation": {
				"hydration": ["findoccupiers"],
				"condition": ["MORETHAN",1,["COUNT","infiltrators"]]
			},
			"oppcantmove": {
				"hydration": ["findoppmovers","findmovetargets"],
				"condition": ["EMPTY","movers"]
			}
		}
	},
	"commands": {
		"move": {
			"neededmarks": ["selectunit","selectmove"],
			"condition": ["NOTEMPTY","forwardfooting"],
			"effect": ["MOVEUNIT",["IDAT",["MARKPOS","selectunit"]],["MARKPOS","selectmove"]]
		}
	},
	"generators": {
		"findoccupiers": {
			"type": "filter",
			"layer": "bases",
			"matching": {"owner":["ISNT",["CONTEXTVAL","CURRENTPLAYER"]]},
			"condition": ["ANYAT","MYUNITS",["CONTEXTPOS","START"]],
			"tolayer": ["LAYERNAME","occupiers"]
		},
		"findinfiltrators": {
			"type": "filter",
			"layer": "corners",
			"matching": {"owner":["ISNT",["CONTEXTVAL","CURRENTPLAYER"]]},
			"condition": ["ANYAT","MYUNITS",["CONTEXTPOS","START"]],
			"tolayer": ["LAYERNAME","infiltrators"]
		},
		"findcurrentmoves": {
			"type": "filter",
			"layer": "movetargets",
			"matching": {"moverid":["IDAT",["MARKPOS","selectunit"]]}
		},
		"findmymovers": {
			"type": "filter",
			"layer": "MYUNITS",
			"condition": ["DIFFERENT",
				["SUM",["CONTEXTVAL","CURRENTTURN"],["VAL",-2]],
				["LOOKUP","MYUNITS",["CONTEXTPOS","START"],"AFFECTEDTURN"]
			],
			"tolayer": "freetomove"
		},
		"findoppmovers": {
			"type": "filter",
			"layer": "OPPUNITS",
			"condition": ["DIFFERENT",
				["SUM",["CONTEXTVAL","CURRENTTURN"],["VAL",-3]],
				["LOOKUP","OPPUNITS",["CONTEXTPOS","START"],"AFFECTEDTURN"]
			],
			"tolayer": "freetomove"
		},
		"findmovetargets": {
			"type": "nextto",
			"from": ["ALLINLAYER","freetomove"],
			"dirs": ["IFELSE",
				["ANYAT","southeast",["CONTEXTPOS","START"]],
				["DIRS",[1,3,4,5,7]],
				["IFELSE",
					["ANYAT","northwest",["CONTEXTPOS","START"]],
					["DIRS",[1,3,5,7,8]],
					["DIRS",[1,3,5,7]]
				]
			],
			"draw": {
				"start": {
					"condition": ["DIFFERENT",["CONTEXTVAL","NEIGHBOURS"],["VAL",0]],
					"tolayer": ["LAYERNAME","movers"]
				},
				"target": {
					"tolayer": ["LAYERNAME","movetargets"],
					"include": {
						"moverid": ["IDAT",["CONTEXTPOS","START"]]
					}
				}
			}
		}
	}
}
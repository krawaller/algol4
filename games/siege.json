{
	"meta": {
		"name": "Siege",
		"source": "https://boardgamegeek.com/boardgame/2873/siege",
		"tags": ["asymmetric","terrain"],
		"author": "Unknown",
		"year": "1966"
	},
	"graphics": {
		"icons": {"knights":"knights","soldiers":"pawns","commander":"kings"},
		"tiles": {"void":"grass","floor":"castle","water":"water","hq":"playercolour"}
	},
	"board": {"height":7,"width":8},
	"terrain": {
		"void": ["a1","b1","g1","h1"],
		"castle": [["rect","c4","f7"]],
		"floor": [["holerect","c4","f7",["d7","e7"]]],
		"water": [["rect","a2","a7"],["rect","h2","h7"]],
		"defenderarea": [["rect","b2","g7"],["rect","c1","f1"]],
		"barracks": [["rect","d5","e6"]],
		"hq": {"2":["d7","e7"]}
	},
	"setup": {
		"knights": { "1": [["rect","c1","f1"]] },
		"soldiers": { "2": [["rect","d5","e6"]] },
		"commander": { "2": ["d7"] }
	},
	"endturn": {
		"endgame": {
			"killcommander": {"condition":["notempty","oppdeadcommander"]}
		}
	},
	"startturn": {
		"allow": ["selectunit"]
	},
	"marks": {
		"selectunit": {
			"from": ["ifelse",["morethan",9,["contextval","turn"]],["subtract","myunits","commander"],"myunits"],
			"runGenerators": ["findknightfirststeps","findknightsecondsteps","findcommanderslides","findcommanderstep","findsoldiermoves"],
			"allow": ["selectmovetarget"]
		},
		"selectmovetarget": {
			"from": ["ifelse",["morethan",9,["contextval","turn"]],["subtract","movetargets","barracks"],"movetargets"],
			"allow": ["move"]
		}
	},
	"commands": {
		"move": {
			"applyEffects": [["kill","selectmovetarget"],["move","selectunit","selectmovetarget"]],
			"allow": ["endturn"]
		}
	},
	"generators": {
		"findknightfirststeps": {
			"type": "nextto",
			"starts": ["intersect","myknights","selectunit"],
			"dirs": ["dirs",[1,3,5,7]],
			"draw": {
				"target": {
					"tolayer": "knightstep1",
					"include": {
						"dir": ["contextval","dir"],
						"startedincastle": ["anyat","castle",["contextpos","start"]]
					}
				}
			}
		},
		"findknightsecondsteps": {
			"type": "nextto",
			"starts": "knightstep1",
			"dirs": ["relativedirs",["dirs",[8,2]],["lookup","knightstep1",["contextpos","start"],"dir"]],
			"condition": ["and",[
				["noneat","void",["contextpos","target"]],
				["noneat","myunits",["contextpos","target"]],
				["or",[
					["falsy",["lookup","knightstep1",["contextpos","start"],"startedincastle"]],
					["anyat","castle",["contextpos","target"]]
				]],
				["or",[
					["anyat","castle",["contextpos","target"]],
					["valinlist",["contextval","dir"],[8,2]]
				]]
			]],
			"draw": {
				"target": {
					"tolayer": "movetargets"
				}
			}
		},
		"findcommanderslides": {
			"type": "walker",
			"dirs": ["dirs",[2,4,6,8]],
			"starts": ["intersect","mycommander","selectunit"],
			"steps": "castle",
			"blocks": "units",
			"draw": {
				"steps": {
					"tolayer": "movetargets"
				},
				"block": {
					"condition": ["noneat","myunits",["contextpos","target"]],
					"tolayer": "movetargets"
				}
			}
		},
		"findcommanderstep": {
			"type": "nextto",
			"starts": ["intersect","mycommander",["intersect","selectunit","hq"]],
			"dirs": ["dirs",[3,7]],
			"condition": ["anyat","hq",["contextpos","target"]],
			"draw": {
				"target": {
					"condition": ["noneat","myunits",["contextpos","target"]],
					"tolayer": "movetargets"
				}
			}
		},
		"findsoldiermoves": {
			"type": "nextto",
			"starts": ["intersect","selectunit","mysoldiers"],
			"condition": ["and",[
				["anyat","defenderarea",["contextpos","target"]],
				["noneat","myunits",["contextpos","target"]]
			]],
			"draw": {
				"target": {
					"condition": ["or",[
						["noneat","oppunits",["contextpos","target"]],
						["valinlist",["contextval","dir"],[2,4,6,8]]
					]],
					"tolayer": "movetargets"
				}
			}
		}
	}
}
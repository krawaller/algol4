{
	"source": "http://www.di.fc.ul.pt/~jpn/gv/sombrero.htm",
	"board": {
		"shape": "square",
		"height": 8,
		"width": 8
	},
	"setup": [
		["list",[1001,1002,1003,1004,8005,8006,8007,8008],{"group":"kings","owner":1}],
		["list",[1005,1006,1007,1008,8001,8002,8003,8004],{"group":"kings","owner":2}]
	],
	"endturn": {
		"condition":["same",["contextval","performedsteps"],["val",1]],
		"commandcap": true,
		"endgame": {
			"kingkill": {
				"condition": ["morethan",2,["positionsin","oppkings"]]
			}
		}
	},
	"marks": {
		"selectking": {
			"from": "mykings"
		},
		"selectswap": {
			"from": "swaptarget",
			"notwith": "selectmove"
		},
		"selectmove": {
			"from": "movetarget",
			"notwith": "selectswap",
			"cleanse": ["demoted"],
			"hydration": ["finddemotees"]
		}
	},
	"startturn": {
		"hydration": ["findtargets"]
	},
	"commands": {
		"swap": {
			"effects": [
				["swapunitpositions",["idofunitat",["markpos","selectking"]],["idofunitat",["markpos","selectswap"]]]
			]
		},
		"move": {
			"effects": [
				["MOVETO",["idofunitat",["markpos","selectking"]],["markpos","selectmove"]],
				["forallin","demoted",
					["setunitdata",["loopid"],"group","soldiers"]
				]
			]
		}
	},
	"generators": {
		"findtargets": {
			"type": "nextto",
			"dirs": ["dirs",[1,2,3,4,5,6,7,8]],
			"start": ["markpos","selectking"],
			"condition": ["and",
				["noneat","oppunits",["contextpos","target"]],
				["noneat","mykings",["contextpos","target"]]
			],
			"draw": {
				"target": {
					"tolayer": ["ifelse",
						["anyat","mysoldiers",["contextpos","target"]],
						"swaptarget","movetarget"
					]
				}
			}
		},
		"finddemotees": {
			"type": "walker",
			"dirs": ["dirs",[1,2,3,4,5,6,7,8]],
			"start": ["markpos","selectmove"],
			"steplayer": "oppunits",
			"stoplayer": "mykings",
			"draw": {
				"step": {
					"condition": ["and",
						["same",["contextval","hitblock"],true],
						["anyat","oppkings",["contextpos","target"]]
					],
					"tolayer": "demoted"
				}
			}
		}
	}
}
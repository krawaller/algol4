{
	"source": "http://www.di.fc.ul.pt/~jpn/gv/sombrero.htm",
	"board": {
		"shape": "square",
		"height": 8,
		"width": 8,
		"setup": [
			{"pos":1001,"type":"king","plr":1},{"pos":1002,"type":"king","plr":1},{"pos":1003,"type":"king","plr":1},{"pos":1004,"type":"king","plr":1},
			{"pos":1005,"type":"king","plr":2},{"pos":1006,"type":"king","plr":2},{"pos":1007,"type":"king","plr":2},{"pos":1008,"type":"king","plr":2},
			{"pos":8001,"type":"king","plr":2},{"pos":8002,"type":"king","plr":2},{"pos":8003,"type":"king","plr":2},{"pos":8004,"type":"king","plr":2},
			{"pos":8005,"type":"king","plr":1},{"pos":8006,"type":"king","plr":1},{"pos":8007,"type":"king","plr":1},{"pos":8008,"type":"king","plr":1}
		]
	},
	"endgame": {
		"kingkill": [["MORE",["VAL",2],["POSITIONSIN","oppkings"]],["CONTEXTVAL","CURRENTPLAYER"]]
	},
	"endturn": {
		"condition":["SAME",["CONTEXTVAL","PERFORMEDSTEPS"],["VAL",1]],
		"commandcap": true
	},
	"marks": {
		"selectking": {
			"from": "mykings"
		},
		"selectswap": {
			"from": "swaptarget"
		},
		"selectmove": {
			"from": "movetarget",
			"notwith": "selectswap"
		}
	},
	"commands": {
		"swap": {
			"effects": [
				["SWAPUNITPOSITIONS",["IDAT",["MARKPOS","selectking"]],["IDAT",["MARKPOS","selectswap"]]]
			]
		},
		"move": {
			"effects": [
				["MOVETO",["IDAT",["MARKPOS","selectking"]],"selectmove"],
				["FORALLIN","demoted",
					["SETUNITDATA",["LOOPID"],"type","soldier"]
				]
			]
		}
	},
	"generators": {
		"findmykings": {
			"type": "filter",
			"layer": "MYUNITS",
			"matching": {"type":["IS",["VAL","king"]]},
			"tolayer": "mykings"
		},
		"findoppkings": {
			"type": "filter",
			"layer": "OPPUNITS",
			"matching": {"type":["IS",["VAL","king"]]},
			"tolayer": "oppkings"
		},
		"findswaptarget": {
			"type": "nextto",
			"dirs": [1,2,3,4,5,6,7,8],
			"start": ["MARKPOS","selectking"],
			"drawtarget": {
				"condition": ["AND",
					["ANYAT","MYUNITS",["CONTEXTPOS","TARGET"]],
					["NONEAT","mykings",["CONTEXTPOS","TARGET"]]
				],
				"tolayer": "swaptarget"
			}
		},
		"findmovetarget": {
			"type": "nextto",
			"dirs": [1,2,3,4,5,6,7,8],
			"start": ["MARKPOS","selectking"],
			"drawtarget": {
				"condition": ["NONEAT","UNITS",["CONTEXTPOS","TARGET"]],
				"tolayer": "movetarget"
			}
		},
		"finddemoters": {
			"type": "walker",
			"dirs": [1,2,3,4,5,6,7,8],
			"start": ["MARKPOS","selectmove"],
			"steplayer": "OPPUNITS",
			"stoplayer": "mykings",
			"drawstep": {
				"condition": ["AND",
					["SAME",["CONTEXTVAL","HITSTOP"],["VAL",true]],
					["ANYAT","oppkings",["CONTEXTPOS","TARGET"]]
				],
				"tolayer": "demoted"
			}
		}
	}
}
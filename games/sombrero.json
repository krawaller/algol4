{
	"source": "http://www.di.fc.ul.pt/~jpn/gv/sombrero.htm",
	"board": {
		"shape": "square",
		"height": 8,
		"width": 8
	},
	"setup": [
		["list",[1001,1002,1003,1004,8005,8006,8007,8008],{"type":"king","owner":1}],
		["list",[1005,1006,1007,1008,8001,8002,8003,8004],{"type":"king","owner":2}]
	],
	"endturn": {
		"condition":["same",["contextval","performedsteps"],["val",1]],
		"commandcap": true,
		"endgame": {
			"kingkill": {
				"condition": [["morethan",["val",2],["positionsin","oppkings"]],["contextval","currentplayer"]]
			}
		}
	},
	"marks": {
		"selectking": {
			"from": "mykings"
		},
		"selectswap": {
			"from": "swaptarget"
		},
		"selectmove": {
			"from": "movetarget",
			"notwith": "selectswap",
			"cleanse": ["demoted"],
			"hydration": ["finddemotees"]
		}
	},
	"commands": {
		"swap": {
			"effects": [
				["swapunitpositions",["idofunitat",["markpos","selectking"]],["idofunitat",["markpos","selectswap"]]]
			]
		},
		"move": {
			"effects": [
				["MOVETO",["idofunitat",["markpos","selectking"]],["markpos","selectmove"]],
				["forallin","demoted",
					["setunitdata",["loopid"],"type","soldier"]
				]
			]
		}
	},
	"generators": {
		"findmykings": {
			"type": "filter",
			"layer": "myunits",
			"matching": {"type":["is",["val","king"]]},
			"tolayer": ["layername","mykings"]
		},
		"findoppkings": {
			"type": "filter",
			"layer": "oppunits",
			"matching": {"type":["is",["val","king"]]},
			"tolayer": ["layername","oppkings"]
		},
		"findswaptarget": {
			"type": "nextto",
			"dirs": ["dirs",1,2,3,4,5,6,7,8],
			"start": ["markpos","selectking"],
			"drawtarget": {
				"condition": ["and",
					["anyat","myunits",["contextpos","target"]],
					["noneat","mykings",["contextpos","target"]]
				],
				"tolayer": ["layername","swaptarget"]
			}
		},
		"findmovetarget": {
			"type": "nextto",
			"dirs": ["dirs",1,2,3,4,5,6,7,8],
			"start": ["markpos","selectking"],
			"drawtarget": {
				"condition": ["noneat","units",["contextpos","target"]],
				"tolayer": ["layername","movetarget"]
			}
		},
		"finddemotees": {
			"type": "walker",
			"dirs": ["dirs",1,2,3,4,5,6,7,8],
			"start": ["markpos","selectmove"],
			"steplayer": "oppunits",
			"stoplayer": "mykings",
			"drawstep": {
				"condition": ["and",
					["same",["contextval","HITSTOP"],["val",true]],
					["anyat","oppkings",["contextpos","target"]]
				],
				"tolayer": ["layername","demoted"]
			}
		}
	}
}
{
	"name": "Conquest",
	"source": "http://www.di.fc.ul.pt/~jpn/gv/conquest.htm",
	"board": {"height": 9,"width": 9},
	"graphics": {
		"tiles": {"plus":"castle","x":"castle","center":"grass"},
		"icons": { "soldiers":"soldiers","kings":"kings" }
	},
	"terrain": {
		"center": [{"pos":5005}],
		"plus": [ ["positions",[4005,5004,5006,6005],{}] ],
		"x": [ ["positions",[4004,4006,6004,6006],{}] ],
		"fortress": [ ["rectangle",4004,6006,{}] ]
	},
	"setup": {
		"soldiers": [
			["positions",[1001,1002,1003,2001,2003,3001,3002,3003],{"owner":1}],
			["positions",[7007,7008,7009,8007,8009,9007,9008,9009],{"owner":2}]
		],
		"kings": [{"pos":2002,"owner":1},{"pos":8008,"owner":2}]
	},
	"marks": {
		"selectunit": {
			"from": "freetomove",
			"condition": ["not",["hasperformedcommand","move"]],
			"rungenerators": ["findmovetargets"],
			"cleanse": ["movetargets"],
			"requiredby": ["selectmovetarget"]
		},
		"selectmovetarget": {
			"requiredmarks": ["selectunit"],
			"from": "movetargets"
		},
		"selectexiletarget": {
			"from": "exiletargets",
			"condition": ["hasperformedcommand","move"],
			"rungenerators": ["findexiledestinations"],
			"requiredby": ["selectexiledestination"],
			"cleanse": ["exiledestinations"]
		},
		"selectexiledestination": {
			"requiredmarks": ["selectexiletarget"],
			"from": "exiledestinations"
		}
	},
	"commands": {
		"move": {
			"neededmarks": ["selectmovetarget"],
			"effect": ["multieffect",[
				["moveunit",["idofunitat",["markpos","selectunit"]],["markpos","selectmovetarget"]],
				["setcontextval","movedto",["markpos","selectmovetarget"]]
			]],
			"rungenerators": ["findexiletargets"]
		},
		"exile": {
			"neededmarks": ["selectexiledestination"],
			"condition": ["hasperformedcommand","move"],
			"rungenerators": ["findexiletargets"],
			"effect": ["moveunit",["idofunitat",["markpos","selectexiletarget"]],["markpos","selectexiledestination"]]
		}
	},
	"startturn": {
		"rungenerators": ["findmovers"]
	},
	"endturn": {
		"condition": ["hasperformedcommand","move"],
		"commandcap": false,
		"endgame": {
			"madeplus": {
				"condition": ["and",[
					["overlaps","mykings","center"],
					["same",["overlapsize","myunits","plus"],4]
				]],
				"result": "win"
			},
			"madex": {
				"condition": ["and",[
					["overlaps","mykings","center"],
					["same",["overlapsize","myunits","x"],4]
				]],
				"result": "win"
			}
		}
	},
	"generators": {
		"findexiletargets": {
			"type": "walker",
			"dirs": ["dirs",[2,4,6,8]],
			"max": 2,
			"starts": ["contextpos","movedto"],
			"steps": "oppunits",
			"blocks": "myunits",
			"prioritizeblocksoversteps":true,
			"draw": {
				"steps": {
					"condition": ["same",["contextval","stopreason"],"hitblock"],
					"tolayer": "exiletargets"
				}
			}
		},
		"findmovers": {
			"type": "nextto",
			"dirs": ["dirs",[2,4,6,8]],
			"starts": "myunits",
			"condition": ["noneat","units",["contextpos","target"]],
			"draw": {
				"start": {
					"condition": ["truthy",["contextval","neighbourcount"]],
					"tolayer": "freetomove"
				},
				"target": {
					"tolayer": "potmovetargets",
					"include": {
						"moverid": ["idofunitat",["contextpos","start"]]
					}
				}
			}
		},
		"findmovetargets": {
			"type": "filter",
			"layer": "potmovetargets",
			"matching": {"moverid":["is",["idofunitat",["markpos","selectunit"]]]},
			"tolayer": "movetargets"
		},
		"findexiledestinations": {
			"type": "filter",
			"layer": ["ifelse", ["same",["lookup","board",["markpos","selectexiletarget"],"colour"],"light"],"light","dark"],
			"condition": ["and",[
				["noneat","fortress",["contextpos","start"]],
				["noneat","units",["contextpos","start"]]
			]],
			"tolayer": "exiledestinations"
		}
	}
}
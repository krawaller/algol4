{
	"meta": {
		"name": "Conquest",
		"source": "http://www.di.fc.ul.pt/~jpn/gv/conquest.htm",
		"tags": ["formation"]
	},
	"board": {"height": 9,"width": 9},
	"graphics": {
		"tiles": {"plus":"castle","x":"castle","center":"grass"},
		"icons": { "soldiers":"pawns","kings":"kings" }
	},
	"terrain": {
		"center": [{"pos":5005}],
		"plus": [ ["positions",[4005,5004,5006,6005]] ],
		"x": [ ["positions",[4004,4006,6004,6006]] ],
		"fortress": [ ["rectangle",4004,6006] ]
	},
	"setup": {
		"soldiers": [["holedrectangle",1001,3003,[2002],1],["holedrectangle",7007,9009,[8008],2]],
		"kings": [{"pos":2002,"owner":1},{"pos":8008,"owner":2}]
	},
	"marks": {
		"selectunit": {
			"from": "myunits",
			"runGenerators": ["findmovetargets"],
			"allow": [["mark","selectmovetarget"]]
		},
		"selectmovetarget": {
			"from": "movetargets",
			"allow": [["command","move"]]
		},
		"selectexiletarget": {
			"from": "exiletargets",
			"runGenerators": ["findexiledestinations"],
			"allow": [["mark","selectexiledestination"]]
		},
		"selectexiledestination": {
			"from": "exiledestinations",
			"allow": [["command","exile"]]
		}
	},
	"commands": {
		"move": {
			"applyEffects": [
				["moveunit",["idofunitat","selectunit"],"selectmovetarget"],
				["setcontextval","movedto",["markpos","selectmovetarget"]]
			]
		},
		"exile": {
			"applyEffects": [["moveunit",["idofunitat","selectexiletarget"],"selectexiledestination"]]
		}
	},
	"startturn": {
		"allow": [["mark","selectunit"]]
	},
	"afterstep": {
		"runGenerators": ["findexiletargets"],
		"allow": [["endturn"],["mark","selectexiletarget"]]
	},
	"endturn": {
		"endgame": {
			"madeplus": {
				"condition": ["and",[
					["overlaps","mykings","center"],
					["same",["overlapsize","myunits","plus"],4]
				]]
			},
			"madex": {
				"condition": ["and",[
					["overlaps","mykings","center"],
					["same",["overlapsize","myunits","x"],4]
				]]
			}
		}
	},
	"generators": {
		"findexiletargets": {
			"type": "walker",
			"dirs": ["dirs",[2,4,6,8]],
			"max": 2,
			"starts": ["contextpos","movedto"],
			"steps": "oppunits",
			"blocks": "myunits",
			"prioritizeblocksoversteps":true,
			"draw": {
				"steps": {
					"condition": ["same",["contextval","stopreason"],"hitblock"],
					"tolayer": "exiletargets"
				}
			}
		},
		"findmovetargets": {
			"type": "nextto",
			"dirs": ["dirs",[2,4,6,8]],
			"starts": "selectunit",
			"condition": ["noneat","units",["contextpos","target"]],
			"draw": {
				"target": {
					"tolayer": "movetargets"
				}
			}
		},
		"findexiledestinations": {
			"type": "filter",
			"layer": ["ifelse", ["same",["lookup","board",["markpos","selectexiletarget"],"colour"],"light"],"light","dark"],
			"condition": ["and",[
				["noneat","fortress",["contextpos","start"]],
				["noneat","units",["contextpos","start"]]
			]],
			"tolayer": "exiledestinations"
		}
	}
}